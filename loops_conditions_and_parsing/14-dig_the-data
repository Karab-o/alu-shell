#!/usr/bin/env bash
# This script processes Apache log files to summarize requests by IP and HTTP status code

# Define the input log file
log_file="apache-access.log"

# Check if the log file exists
if [[ ! -f "$log_file" ]]; then
  echo "Log file not found!"
  exit 1
fi

# Process the log file using awk
awk '{
    # Match the log format and extract IP and HTTP status code
    match($0, /^([0-9\.]+) - - \[[^]]+\] "[^"]+" ([0-9]{3})/, arr);
    if (arr[1] != "") {
        count[arr[1], arr[2]]++;
    }
}
END {
    # Output the results sorted by occurrence
    for (ip in count) {
        split(ip, keys, SUBSEP);
        printf "%d %s %s\n", count[ip], keys[1], keys[2];
    }
}' "$log_file" | sort -nr | awk '{ printf "%d %s %s\n", $1, $2, $3 }'

